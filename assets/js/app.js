const languages = {
  "pt": {
    name: "PortuguÃªs",
    icon: `
    <svg class="h-6 w-6 lg:h-3.5 lg:w-3.5 lg:rounded-full lg:me-2" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-2100 -1470 4200 2940">
                    <defs>
                      <path id="D" fill-rule="evenodd"
                        d="m-31.5 0h33a30 30 0 0 0 30 -30v-10a30 30 0 0 0 -30 -30h-33zm13-13h19a19 19 0 0 0 19 -19v-6a19 19 0 0 0 -19 -19h-19z" />
                      <path id="E" transform="translate(-31.5)" d="m0 0h63v-13h-51v-18h40v-12h-40v-14h48v-13h-60z" />
                      <path id="e" d="m-26.25 0h52.5v-12h-40.5v-16h33v-12h-33v-11h39.25v-12h-51.25z" />
                      <g id="G">
                        <clipPath id="gcut">
                          <path d="m-31.5 0v-70h63v70zm31.5-47v12h31.5v-12z" />
                        </clipPath>
                        <use xlink:href="#O" clip-path="url(#gcut)" />
                        <rect y="-35" x="5" height="10" width="26.5" />
                        <rect y="-35" x="21.5" height="35" width="10" />
                      </g>
                      <path id="M" d="m-31.5 0h12v-48l14 48h11l14-48v48h12v-70h-17.5l-14 48-14-48h-17.5z" />
                      <path id="O" fill-rule="evenodd"
                        d="m0 0a31.5 35 0 0 0 0 -70 31.5 35 0 0 0 0 70m0-13a18.5 22 0 0 0 0 -44 18.5 22 0 0 0 0 44" />
                      <path id="P" fill-rule="evenodd"
                        d="m-31.5 0h13v-26h28a22 22 0 0 0 0 -44h-40zm13-39h27a9 9 0 0 0 0 -18h-27z" />
                      <g id="R">
                        <use xlink:href="#P" />
                        <path d="m28 0c0-10 0-32-15-32h-19c22 0 22 22 22 32" />
                      </g>
                      <path id="S"
                        d="m-15.75-22c0 7 6.75 10.5 16.75 10.5s14.74-3.25 14.75-7.75c0-14.25-46.75-5.25-46.5-30.25 0.25-21.5 24.75-20.5 33.75-20.5s26 4 25.75 21.25h-15.25c0-7.5-7-10.25-15-10.25-7.75 0-13.25 1.25-13.25 8.5-0.25 11.75 46.25 4 46.25 28.75 0 18.25-18 21.75-31.5 21.75-11.5 0-31.55-4.5-31.5-22z" />
                      <g id="star" fill="#fff">
                        <g id="c">
                          <path id="t" transform="rotate(18 0,-1)" d="m0-1v1h0.5" />
                          <use xlink:href="#t" transform="scale(-1,1)" />
                        </g>
                        <use xlink:href="#c" transform="rotate(72)" />
                        <use xlink:href="#c" transform="rotate(-72)" />
                        <use xlink:href="#c" transform="rotate(144)" />
                        <use xlink:href="#c" transform="rotate(216)" />
                      </g>
                      <use id="star1" xlink:href="#star" transform="scale(31.5)" />
                      <use id="star2" xlink:href="#star" transform="scale(26.25)" />
                      <use id="star3" xlink:href="#star" transform="scale(21)" />
                      <use id="star4" xlink:href="#star" transform="scale(15)" />
                      <use id="star5" xlink:href="#star" transform="scale(10.5)" />
                    </defs>
                    <rect y="-50%" x="-50%" height="100%" fill="#009b3a" width="100%" />
                    <path d="m-1743 0 1743 1113 1743-1113-1743-1113z" fill="#fedf00" />
                    <circle r="735" fill="#002776" />
                    <clipPath id="band">
                      <circle r="735" />
                    </clipPath>
                    <path fill="#fff" d="m-2205 1470a1785 1785 0 0 1 3570 0h-105a1680 1680 0 1 0 -3360 0z"
                      clip-path="url(#band)" />
                    <g transform="translate(-420,1470)" fill="#009b3a">
                      <use y="-1697.5" xlink:href="#O" transform="rotate(-7)" />
                      <use y="-1697.5" xlink:href="#R" transform="rotate(-4)" />
                      <use y="-1697.5" xlink:href="#D" transform="rotate(-1)" />
                      <use y="-1697.5" xlink:href="#E" transform="rotate(2)" />
                      <use y="-1697.5" xlink:href="#M" transform="rotate(5)" />
                      <use y="-1697.5" xlink:href="#e" transform="rotate(9.75)" />
                      <use y="-1697.5" xlink:href="#P" transform="rotate(14.5)" />
                      <use y="-1697.5" xlink:href="#R" transform="rotate(17.5)" />
                      <use y="-1697.5" xlink:href="#O" transform="rotate(20.5)" />
                      <use y="-1697.5" xlink:href="#G" transform="rotate(23.5)" />
                      <use y="-1697.5" xlink:href="#R" transform="rotate(26.5)" />
                      <use y="-1697.5" xlink:href="#E" transform="rotate(29.5)" />
                      <use y="-1697.5" xlink:href="#S" transform="rotate(32.5)" />
                      <use y="-1697.5" xlink:href="#S" transform="rotate(35.5)" />
                      <use y="-1697.5" xlink:href="#O" transform="rotate(38.5)" />
                    </g>
                  </svg>
    `
  },
  "en": {
    name: "English",
    icon: `
    <svg aria-hidden="true" class="h-6 w-6 lg:h-3.5 lg:w-3.5 lg:rounded-full lg:me-2" xmlns="http://www.w3.org/2000/svg"
      id="flag-icon-css-us" viewBox="0 0 512 512">
      <g fill-rule="evenodd">
        <g stroke-width="1pt">
          <path fill="#bd3d44"
            d="M0 0h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0z"
            transform="scale(3.9385)" />
          <path fill="#fff"
            d="M0 10h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0z"
            transform="scale(3.9385)" />
        </g>
        <path fill="#192f5d" d="M0 0h98.8v70H0z" transform="scale(3.9385)" />
        <path fill="#fff"
          d="M8.2 3l1 2.8H12L9.7 7.5l.9 2.7-2.4-1.7L6 10.2l.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8H45l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.4 1.7 1 2.7L74 8.5l-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9L92 7.5l1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm-74.1 7l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7H65zm16.4 0l1 2.8H86l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm-74 7l.8 2.8h3l-2.4 1.7.9 2.7-2.4-1.7L6 24.2l.9-2.7-2.4-1.7h3zm16.4 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8H45l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9L92 21.5l1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm-74.1 7l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7H65zm16.4 0l1 2.8H86l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm-74 7l.8 2.8h3l-2.4 1.7.9 2.7-2.4-1.7L6 38.2l.9-2.7-2.4-1.7h3zm16.4 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8H45l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9L92 35.5l1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm-74.1 7l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7H65zm16.4 0l1 2.8H86l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm-74 7l.8 2.8h3l-2.4 1.7.9 2.7-2.4-1.7L6 52.2l.9-2.7-2.4-1.7h3zm16.4 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8H45l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9L92 49.5l1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm-74.1 7l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7H65zm16.4 0l1 2.8H86l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm-74 7l.8 2.8h3l-2.4 1.7.9 2.7-2.4-1.7L6 66.2l.9-2.7-2.4-1.7h3zm16.4 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8H45l-2.4 1.7 1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9zm16.4 0l1 2.8h2.8l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h3zm16.5 0l.9 2.8h2.9l-2.3 1.7.9 2.7-2.4-1.7-2.3 1.7.9-2.7-2.4-1.7h2.9zm16.5 0l.9 2.8h2.9L92 63.5l1 2.7-2.4-1.7-2.4 1.7 1-2.7-2.4-1.7h2.9z"
          transform="scale(3.9385)" />
      </g>
    </svg>
    `
  }
};

const menuActive = "font-bold block py-2 px-3 rounded lg:p-0 lg:bg-transparent lg:text-green-500 bg-green-700 text-white";
const menuInactive = "font-bold block py-2 px-3 rounded lg:p-0 lg:hover:underline lg:underline-offset-4 lg:decoration-2 text-gray-900 lg:hover:bg-transparent lg:hover:text-green-400 dark:text-white lg:dark:hover:text-green-500 lg:dark:hover:bg-transparent dark:border-gray-700";

var ignoreScrollEvent = false;

const sections = {
  home: document.getElementById("home"),
  about: document.getElementById("about"),
  skills: document.getElementById("skills"),
  contact: document.getElementById("contact"),
}

document.addEventListener('alpine:init', () => {
  Alpine.data('menu', () => ({
    open: false,

    toggle() {
      this.open = !this.open
    }
  }));

  Alpine.store('language', {
    init() {
      let language = (window.navigator.userLanguage || window.navigator.language).substr(0,2);

      const urlParams = new URLSearchParams(window.location.search);
      const langFromUrl = urlParams.get('lang');
      if (langFromUrl && availableLocales.includes(langFromUrl)) {
        language = langFromUrl
      }

      let pageLanguage = defaultLanguage;
      if (availableLocales.includes(language)) {
        pageLanguage = language;
      }

      this.selected = languages[pageLanguage];
      this.lang = pageLanguage
    },

    lang: 'pt',
    selected: languages['pt'],

    setLang(lang) {
      this.lang = lang;

      this.selected = languages[lang];

      window.navigator.userLanguage = lang;

      const languageDropdownInstance = FlowbiteInstances.getAllInstances()['Dropdown']['language-dropdown-menu'];
      languageDropdownInstance.hide();

      translate();
    }
  });

  Alpine.store('currentMenu', {
    init() {
      const menuEl = document.getElementById('home-menu');

      menuEl.classList.remove(...menuInactive.split(" "));
      menuEl.classList.add(...menuActive.split(" "));
    },

    menu: 'home-menu',

    change(newMenu) {
      const lastMenuEl = document.getElementById(this.menu);
      const newMenuEl = document.getElementById(newMenu);

      if (newMenuEl && this.menu !== newMenu) {
        this.menu = newMenu;

        lastMenuEl.classList.remove(...menuActive.split(" "));
        lastMenuEl.classList.add(...menuInactive.split(" "));
        lastMenuEl.style.pointerEvents = "none";
        lastMenuEl.style.pointerEvents = "auto";

        newMenuEl.classList.remove(...menuInactive.split(" "));
        newMenuEl.classList.add(...menuActive.split(" "));
      }
    },

    changeAndScroll(newMenu) {
      this.change(newMenu);

      this.scroll(newMenu);
    },

    scroll(menu) {
      const sectionName = menu.split("-");
      const section = sections[sectionName[0]];

      if (section) {
        ignoreScrollEvent = true;
        section.scrollIntoView({ behavior: 'smooth' });
      }
    }
  });

  Alpine.store('darkMode', {
    init() {
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        this.active = true;
      } else {
        this.active = false;
      }

      if (this.active) {
        document.getElementsByTagName('html')[0].classList.add("dark");
      } else {
        document.getElementsByTagName('html')[0].classList.remove("dark");
      }
    },

    active: true,

    toggle() {
      this.active = !this.active;

      if (this.active) {
        document.getElementsByTagName('html')[0].classList.add("dark");
      } else {
        document.getElementsByTagName('html')[0].classList.remove("dark");
      }
    }
  });

  document.addEventListener("scroll", (event) => {
    var ignore = ignoreScrollEvent;
    
    ignoreScrollEvent = false;

    if (ignore) return;
    
    const y = window.scrollY;

    let currentSection = "home";

    for (const section of Object.values(sections)) {
      const elHeight = section.getBoundingClientRect();

      if (y > elHeight.top) {
        currentSection = section.id;
      }
    }

    Alpine.store('currentMenu').change(currentSection + '-menu');
  });

  const menuButtonEl = document.getElementById("menu-button");

  menuButtonEl.addEventListener("focusout", (event) => {
    const menuButtonInstance = FlowbiteInstances.getAllInstances()['Collapse']['menu-mobile'];
    setTimeout(() => {
      menuButtonInstance.collapse();
    }, 10);
  });
});

var prevScrollpos = window.scrollY;
window.onscroll = function() {
  var currentScrollPos = window.scrollY;
  if (prevScrollpos > currentScrollPos) {
    document.getElementById("navbar").style.top = "0";
  } else {
    document.getElementById("navbar").style.top = "-100px";
  }
  prevScrollpos = currentScrollPos;
}
